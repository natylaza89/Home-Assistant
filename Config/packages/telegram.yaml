###############################################################################
#   @author         :   Naty Laza
#   @date           :   28/10/2018
#   @package        :   Telegram Configuration
#   @description    :   Telegram Bot with Allowed Chat,Commands To Control&Getters
#                       of data from HA, Notifications
###############################################################################

####################################################
#                   Customize                      #
####################################################

homeassistant:
  customize_domain:
    automation:
      initial_state: 'on'

  customize:
#Automations
     automation.telegram_start_command:
      icon: mdi:telegram
     automation.telegram_info_command:
      icon: mdi:telegram
     automation.telegram_sensors_command:
      icon: mdi:telegram
     automation.telegram_tracker_command:
      icon: mdi:telegram
     automation.telegram_alarm_command:
      icon: mdi:telegram
     automation.telegram_devices_command:
      icon: mdi:telegram
     automation.telegram_livingroom_command:
      icon: mdi:telegram
     automation.telegram_bedroom_command:
      icon: mdi:telegram
     automation.telegram_entities_status_command:
      icon: mdi:telegram
     automation.telegram_ssl_command:
      icon: mdi:telegram
     automation.telegram_sensors_status_command:
      icon: mdi:telegram
     automation.telegram_sensor_battery_status_command:
      icon: mdi:telegram
     automation.telegram_temperature_status_command:
      icon: mdi:telegram
     automation.telegram_humidity_status_command:
      icon: mdi:telegram
     automation.telegram_naty_status_command:
      icon: mdi:telegram
     automation.telegram_nofar_status_command:
      icon: mdi:telegram
     automation.telegram_tv_power_off_command:
      icon: mdi:telegram
     automation.telegram_tv_power_on_command:
      icon: mdi:telegram
     automation.telegram_strip_led_power_off_command:
      icon: mdi:telegram
     automation.telegram_strip_led_power_on_command:
      icon: mdi:telegram
     automation.telegram_mi_box_power_off_command:
      icon: mdi:telegram
     automation.telegram_mi_box_power_on_command:
      icon: mdi:telegram
     automation.telegram_ac_power_off_command:
      icon: mdi:telegram
     automation.telegram_ac_power_on_command:
      icon: mdi:telegram
     automation.telegram_alarm_off_command:
      icon: mdi:telegram
     automation.telegram_alarm_on_command:
      icon: mdi:telegram
     automation.telegram_fan_light_power_off_command:
      icon: mdi:telegram
     automation.telegram_fan_light_power_on_command:
      icon: mdi:telegram
     automation.telegram_fan_power_off_command:
      icon: mdi:telegram
     automation.telegram_fan_power_on_command:
      icon: mdi:telegram
     automation.telegram_fan_mode_command:
      icon: mdi:telegram
      
####################################################
#                     Telegram Bot                 #
####################################################

telegram_bot:
  - platform: polling
    api_key: !secret telegram_api_key
    allowed_chat_ids:
      - !secret telegram_naty_id
      - !secret telegram_nofar_id
      - !secret telegram_mipad_id
     
####################################################
#                Telegram Bot  Notify              #
####################################################

notify:
  - name: telehome_naty
    platform: telegram
    chat_id: !secret telegram_naty_id
  - name: telehome_nofar
    platform: telegram
    chat_id: !secret telegram_nofar_id
  - name: telehome_mipad
    platform: telegram
    chat_id: !secret telegram_mipad_id
  - platform: group
    name: all
    services:
      - service: telehome_naty
      - service: telehome_nofar
      - service: telehome_mipad

####################################################
#                   Telegram Commands              #
####################################################
automation:

####################################################
#                   Main Menu                      #
####################################################
- id: Telegram Start Command
  alias: Telegram Start Command
  initial_state: on
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
        command: '/start'
  action:
  - service: telegram_bot.send_message
    data_template:
       target: '{{ trigger.event.data.user_id }}'
       message: |
            *Hello, I'm Naty's bot.*
            Please use the custom commands in order to get what you wish for:
       keyboard:
          - '/info, /sensors, /alarm'
          - '/tracker, /devices'

####################################################
#                 Sub Group Menu                   #
####################################################

#Information
- id: Telegram Info Command
  alias: Telegram Info Command
  initial_state: on
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
        command: '/info'
  action:
  - service: telegram_bot.send_message
    data_template:
       target: '{{ trigger.event.data.user_id }}'
       message: |
            *Information Control Pannel*
            Please use the custom commands in order to get what you wish for:
       keyboard:
          - '/entities, /ssl '
          - '/start'

#Sensors
- id: Telegram Sensors Command
  alias: Telegram Sensors Command
  initial_state: on
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
        command: '/sensors'
  action:
  - service: telegram_bot.send_message
    data_template:
       target: '{{ trigger.event.data.user_id }}'
       message: |
            *Information Control Pannel*
            Please use the custom commands in order to get what you wish for:
       keyboard:
          - '/sensor, /battery'
          - ' /temperature , /humidity'
          - '/start'

#Alarm Control
- id: Telegram Alarm Command
  alias: Telegram Alarm Command
  initial_state: on
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
        command: '/alarm'
  action:
  - service: telegram_bot.send_message
    data_template:
       target: '{{ trigger.event.data.user_id }}'
       message: |
            *Alarm Control Pannel*
            Please use the custom commands in order to get what you wish for:
       keyboard:
          - '/alarmon, /alarmoff'
          - '/start'

#Device Tracker
- id: Telegram Tracker Command
  alias: Telegram Tracker Command
  initial_state: on
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
        command: '/tracker'
  action:
  - service: telegram_bot.send_message
    data_template:
       target: '{{ trigger.event.data.user_id }}'
       message: |
            *Device Tracker Control Pannel*
            Please use the custom commands in order to get what you wish for:
       keyboard:
          - '/naty, /nofar'
          - '/start'

#Devices
- id: Telegram Devices Command
  alias: Telegram Devices Command
  initial_state: on
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
        command: '/devices'
  action:
  - service: telegram_bot.send_message
    data_template:
       target: '{{ trigger.event.data.user_id }}'
       message: |
            *Devices Control Pannel*
            Please use the custom commands in order to get what you wish for:
       keyboard:
          - '/livingroom, /bedroom'
          - '/start'

#Living Room
- id: Telegram LivingRoom Command
  alias: Telegram LivingRoom Command
  initial_state: on
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
        command: '/livingroom'
  action:
  - service: telegram_bot.send_message
    data_template:
       target: '{{ trigger.event.data.user_id }}'
       message: |
            *Living Room Device Control*
            Please use the custom commands in order to get what you wish for:
       keyboard:
          - '/acon, /acoff, /tvon , /tvoff '
          - '/miboxon, /miboxoff , /stripon, /stripoff'
          - '/start , /devices'
          
#Bed Room
- id: Telegram BedRoom Command
  alias: Telegram BedRoom Command
  initial_state: on
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
        command: '/bedroom'
  action:
  - service: telegram_bot.send_message
    data_template:
       target: '{{ trigger.event.data.user_id }}'
       message: |
            *Devices Control Pannel*
            Please use the custom commands in order to get what you wish for:
       keyboard:
          - '/fanon , /fanoff, /fanlighton , '
          - '/fanmode, /fanlightoff'
          - '/start , /devices'
         

####################################################
#                Actual Commands                   #
####################################################

#Entities
- id: Telegram Entities Status Command
  alias: Telegram Entities Status Command
  initial_state: on
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
        command: '/entities'
  action:
  - service: telegram_bot.send_message
    data_template:
       target: '{{ trigger.event.data.user_id }}'
       title: '*Home Entities Status*'
       message: |
            - Security Alarm is *{{ 'On' if states.sensor.alarm_control_panel_status.state == 'armed_home' else 'Off' }}*
            - Xiaomi Plug is *{{ 'On' if states.switch.xiaomi_plug.state == 'on' else 'Off' }}*
            - Gateway Light is *{{ 'On' if states.light.gateway_light.state == 'on' else 'Off' }}*
            - Living Room Air Condtioner is *{{ 'On' if states.switch.lrac_power.state == 'on' else 'Off' }}*
            - Bedroom Fan Light is *{{ 'On' if states.switch.brfan_light.state == 'on' else 'Off' }}*
            - Bedroom Fan  is *{{ 'On' if states.fan.bedroom_fan.state == 'on' else 'Off' }}*
            - Living Room TV is *{{ 'On' if states.switch.lrtv_power.state == 'on' else 'Off' }}*
            - Living Room Mi Box 3 is *{{ 'On' if states.switch.lrmibox_power.state == 'on' else 'Off' }}*

#SSL
- id: Telegram SSL Command
  alias: Telegram SSL Command
  initial_state: on
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
        command: '/ssl'
  action:
  - service: telegram_bot.send_message
    data_template:
       target: '{{ trigger.event.data.user_id }}'
       title: '*Security SSL Status*'
       message: |
              SSL Certificate Expiry : *{{ states.sensor.ssl_certificate_expiry.state }}*
              Make sure it will renew the certificate.
#############################################################################################

#Sensor Status
- id: Telegram Sensors Status Command
  alias: Telegram Sensors Status Command
  initial_state: on
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
        command: '/sensor'
  action:
  - service: telegram_bot.send_message
    data_template:
       target: '{{ trigger.event.data.user_id }}'
       title: '*Sensors Status*'
       message: |
            - Living Room Window Right Side is *{{ 'Open' if states.binary_sensor.lr_window_right.state == 'on' else 'Closed' }}*
            - Living Room Window left Side is *{{ 'Open' if states.binary_sensor.lr_window_left.state == 'on' else 'Closed' }}*
            - Kitchen Window is *{{ 'Open' if states.binary_sensor.kitchen_window.state == 'on' else 'Closed' }}*
            - Bedroom Window is *{{ 'Open' if states.binary_sensor.bedroom_window.state == 'on' else 'Closed' }}*
            - Laundry Room Window is *{{ 'Open' if states.binary_sensor.laundry_window.state == 'on' else 'Closed' }}*
            - Work Room Window is *{{ 'Open' if states.binary_sensor.workroom_window.state == 'on' else 'Closed' }}*
            - Water Leak Sensor is *{{ 'Wet' if states.binary_sensor.water_leak_sensor.state == 'on' else 'Dry' }}* 
            - Motion Sensor is *{{ 'Detected' if states.binary_sensor.motion_sensor.state == 'on' else 'Clear' }}* 
            - Smoke Detector is *{{ 'Detected' if states.binary_sensor.smoke_sensor_lr.state == 'on' else 'Clear' }}* 
#Battery Status
- id: Telegram Sensor Battery Status Command
  alias: Telegram Sensor Battery Status Command
  initial_state: on
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
        command: '/battery'
  action:
  - service: telegram_bot.send_message
    data_template:
       target: '{{ trigger.event.data.user_id }}'
       title: '*Sensors Battery Status*'
       message: |
            - Living Room Left Window Sensor is *{{ states.binary_sensor.lr_window_right.attributes.battery_level }}%*
            - Living Room Right Window Sensor is *{{ states.binary_sensor.lr_window_left.attributes.battery_level }}%*
            - Bedroom Window Sensor is *{{ states.binary_sensor.bedroom_window.attributes.battery_level }}%*
            - Kitchen Window Sensor is *{{ states.binary_sensor.kitchen_window.attributes.battery_level }}%*
            - Laundry Room Window Sensor is *{{ states.binary_sensor.laundry_window.attributes.battery_level }}%*
            - Work Room Window Sensor is *{{ states.binary_sensor.workroom_window.attributes.battery_level }}%*
            - Living Room Temperature Sensor is *{{ states.sensor.temperature_livingroom.attributes.battery_level }}%*
            - Bedroom Temperature Sensor is *{{ states.sensor.temperature_bedroom.attributes.battery_level }}%*
            - Kitchen Temperature Sensor is *{{ states.sensor.temperature_kitchen.attributes.battery_level }}%*
            - Work Room Temperature Sensor is *{{ states.sensor.temperature_workroom.attributes.battery_level }}%*
            - Xiaomi Motion Sensor is *{{ states.binary_sensor.motion_sensor.attributes.battery_level }}%*
            - Xiaomi Switch is *{{ states.binary_sensor.switch.attributes.battery_level }}%*
            - Water Leak Sensor is *{{ states.binary_sensor.water_leak_sensor.attributes.battery_level }}%*
            - Smoke Detector is *{{ states.binary_sensor.smoke_detector_batterylevel.attributes.battery_level }}* 
#Temperature Status
- id: Telegram Temperature Status Command
  alias: Telegram Temperature Status Command
  initial_state: on
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
        command: '/temperature'
  action:
  - service: telegram_bot.send_message
    data_template:
       target: '{{ trigger.event.data.user_id }}'
       title: '*Temperature Status*'
       message: |
            - Living Room Temperature is *{{ states.sensor.temperature_livingroom.state }}째C*
            - Bedroom Temperature is *{{ states.sensor.temperature_bedroom.state }}째C*
            - Kitchen Temperature is *{{ states.sensor.temperature_kitchen.state }}째C*
            - Work Room Temperature is *{{ states.sensor.temperature_workroom.state }}째C*
            
#Humidity Status
- id: Telegram Humidity Status Command
  alias: Telegram Humidity Status Command
  initial_state: on
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
        command: '/humidity'
  action:
  - service: telegram_bot.send_message
    data_template:
       target: '{{ trigger.event.data.user_id }}'
       title: '*Humidity Status*'
       message: |
            - Living Room Humidity is *{{ states.sensor.humidity_livingroom.state }}%*
            - Bedroom Humidity is *{{ states.sensor.humidity_bedroom.state }}%*
            - Kitchen Humidity is *{{ states.sensor.humidity_kitchen.state }}%*
            - Work Room Humidity is *{{ states.sensor.humidity_workroom.state }}%*
##################################################################################################
#Alarm On
- id: Telegram Alarm On Command
  alias: Telegram Alarm On Command
  initial_state: on
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
        command: '/alarmon'
  action:
  - service: telegram_bot.send_message
    data_template:
       target: '{{ trigger.event.data.user_id }}'
       title: '*Security Alarm Status*'
       message: |
            You turned on the Alarm.
            Be Aware now that the Alarm system is online and every sensor
            will trigger it on.
  - service: alarm_control_panel.alarm_arm_home
    data_template:
        entity_id: alarm_control_panel.home_alarm
        code: !secret alarm_code
  - service: script.alarm_home_power_state

#Alarm Off
- id: Telegram Alarm Off Command
  alias: Telegram Alarm Off Command
  initial_state: on
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
        command: '/alarmoff'
  action:
  - service: telegram_bot.send_message
    data_template:
       target: '{{ trigger.event.data.user_id }}'
       title: '*Security Alarm Status*'
       message: |
            You turned Off the Alarm.
            Be Aware now that the Alarm system is offline
            and you get notification for each sensor individual.
  - service: alarm_control_panel.alarm_disarm
    data_template:
        entity_id: alarm_control_panel.home_alarm
        code: !secret alarm_code
  - service: script.alarm_home_power_state
################################################################################################

#Naty Status
- id: Telegram Naty Status Command
  alias: Telegram Naty Status Command
  initial_state: on
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
        command: '/naty'
  action:
  - service: telegram_bot.send_message
    data_template:
       target: '{{ trigger.event.data.user_id }}'
       title: '*Naty Status*'
       message: |
            - TrackR's Battery:  *{{ states.device_tracker.nl.attributes.battery_level }}%*
            - Device Tracker Status: *{{ states.sensor.naty_current_status.state }}*
            - Latitude: {{ states.device_tracker.nl.attributes.latitude }}
            - Longitude: {{ states.device_tracker.nl.attributes.longitude }}

#Nofar Status
- id: Telegram Nofar Status Command
  alias: Telegram Nofar Status Command
  initial_state: on
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
        command: '/nofar'
  action:
  - service: telegram_bot.send_message
    data_template:
       target: '{{ trigger.event.data.user_id }}'
       title: '*Nofar Status*'
       message: |
            - TrackR's Battery:  *{{ states.device_tracker.nc.attributes.battery_level }}%*
            - Device Tracker Status: *{{ states.sensor.nofar_current_status.state }}*
            - Latitude: {{ states.device_tracker.nc.attributes.latitude }}
            - Longitude: {{ states.device_tracker.nc.attributes.longitude }}
#################################################################################################

####################################################
#          Living Room Control Pannel              #
####################################################
        
#LR AC Power On
- id: Telegram AC Power On Command
  alias: Telegram AC Power On Command
  initial_state: on
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
        command: '/acon'
  action:
  - service: switch.toggle
    entity_id: switch.lrac_power

#LR AC Power Off
- id: Telegram AC Power Off Command
  alias: Telegram AC Power Off Command
  initial_state: on
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
        command: '/acoff'
  action:
  - service: switch.toggle
    entity_id: switch.lrac_power
    
#LR TV Power On
- id: Telegram TV Power On Command
  alias: Telegram TV Power On Command
  initial_state: on
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
        command: '/tvon'
  action:
  - service: switch.toggle
    entity_id: switch.lrtv_power

#LR TV Power Off
- id: Telegram TV Power Off Command
  alias: Telegram TV Power Off Command
  initial_state: on
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
        command: '/tvoff'
  action:
  - service: switch.toggle
    entity_id: switch.lrtv_power

#LR Mi Box Power On
- id: Telegram Mi Box Power On Command
  alias: Telegram Mi Box Power On Command
  initial_state: on
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
        command: '/miboxon'
  action:
  - service: switch.toggle
    entity_id: switch.lrmibox_power

#LR Mi Box Power Off
- id: Telegram Mi Box Power Off Command
  alias: Telegram Mi Box Power Off Command
  initial_state: on
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
        command: '/miboxoff'
  action:
  - service: switch.toggle
    entity_id: switch.lrmibox_power

#LR Strip Led Power On
- id: Telegram Strip Led Power On Command
  alias: Telegram Strip Led Power On Command
  initial_state: on
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
        command: '/stripon'
  action:
  - service: switch.toggle
    entity_id: switch.lrtv_stripled_power

#LR Mi Box Power Off
- id: Telegram Strip Led Power Off Command
  alias: Telegram Strip Led Power Off Command
  initial_state: on
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
        command: '/stripoff'
  action:
  - service: switch.toggle
    entity_id: switch.lrtv_stripled_power

####################################################
#             Bed Room Control Pannel              #
####################################################
        
#BR Fan Power On
- id: Telegram Fan Power On Command
  alias: Telegram Fan Power On Command
  initial_state: on
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
        command: '/fanon'
  action:
  - service: fan.toggle
    entity_id: fan.bedroom_fan

#BR Fan Power Off
- id: Telegram Fan Power Off Command
  alias: Telegram Fan Power Off Command
  initial_state: on
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
        command: '/fanoff'
  action:
  - service: fan.toggle
    entity_id: fan.bedroom_fan

#BR Fan Light Power On
- id: Telegram Fan Light Power On Command
  alias: Telegram Fan Light Power On Command
  initial_state: on
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
        command: '/fanlighton'
  action:
  - service: switch.toggle
    entity_id: switch.brfan_light

#BR Fan Light Power Off
- id: Telegram Fan Light Power Off Command
  alias: Telegram Fan Light Power Off Command
  initial_state: on
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
        command: '/fanlightoff'
  action:
  - service: switch.toggle
    entity_id: switch.brfan_light

#BR Fan Mode
- id: Telegram Fan Mode Command
  alias: Telegram Fan Mode Command
  initial_state: on
  trigger:
  - platform: event
    event_type: telegram_command
    event_data:
        command: '/fanmode'
  action:
  - service: input_select.select_next
    entity_id: input_select.br_fan
